<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress - BrightMind</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-indigo-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-brain text-2xl"></i>
                    <h1 class="text-2xl font-bold">BrightMind</h1>
                </div>
                <nav>
                    <ul class="flex space-x-6">
                        <li><a href="index.html" class="hover:text-indigo-200">Home</a></li>
                        <li><a href="iq-test.html" class="hover:text-indigo-200">IQ Test</a></li>
                        <li><a href="health-check.html" class="hover:text-indigo-200">Health Check</a></li>
                        <li><a href="recommendations.html" class="hover:text-indigo-200">Recommendations</a></li>
                        <li><a href="tutoring.html" class="hover:text-indigo-200">AI Tutor</a></li>
                        <li><a href="progress.html" class="hover:text-indigo-200 font-medium">Progress</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold text-center mb-8">Your Progress Dashboard</h2>
            
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Cognitive Performance -->
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">Cognitive Performance</h3>
                        <div class="bg-indigo-100 text-indigo-800 p-2 rounded-lg">
                            <i class="fas fa-brain"></i>
                        </div>
                    </div>
                    <div class="text-4xl font-bold mb-2" id="cognitive-score">--</div>
                    <div class="flex items-center text-sm text-gray-500">
                        <span id="cognitive-trend" class="mr-1">--</span>
                        <span id="cognitive-change">--</span>
                    </div>
                </div>
                
                <!-- Health Status -->
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">Health Status</h3>
                        <div class="bg-green-100 text-green-800 p-2 rounded-lg">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                    </div>
                    <div class="text-4xl font-bold mb-2" id="health-score">--</div>
                    <div class="flex items-center text-sm text-gray-500">
                        <span id="health-trend" class="mr-1">--</span>
                        <span id="health-change">--</span>
                    </div>
                </div>
                
                <!-- Study Habits -->
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">Study Habits</h3>
                        <div class="bg-blue-100 text-blue-800 p-2 rounded-lg">
                            <i class="fas fa-book"></i>
                        </div>
                    </div>
                    <div class="text-4xl font-bold mb-2" id="study-score">--</div>
                    <div class="flex items-center text-sm text-gray-500">
                        <span id="study-trend" class="mr-1">--</span>
                        <span id="study-change">--</span>
                    </div>
                </div>
            </div>
            
            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Cognitive Performance Chart -->
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-lg font-semibold mb-4">Cognitive Performance Trend</h3>
                    <canvas id="cognitive-chart" height="300"></canvas>
                </div>
                
                <!-- Health Metrics Chart -->
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-lg font-semibold mb-4">Health Metrics Trend</h3>
                    <canvas id="health-chart" height="300"></canvas>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Activity</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Result</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="activity-table">
                            <!-- Activity data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Insights Section -->
            <div class="bg-indigo-50 p-6 rounded-xl">
                <h3 class="text-xl font-semibold mb-4 text-indigo-700">Personalized Insights</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-2">Cognitive Strengths</h4>
                        <ul class="list-disc pl-5 space-y-1" id="strengths-list">
                            <!-- Strengths will be loaded here -->
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">Areas for Improvement</h4>
                        <ul class="list-disc pl-5 space-y-1" id="improvement-list">
                            <!-- Improvements will be loaded here -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-brain text-2xl"></i>
                        <h2 class="text-xl font-bold">BrightMind</h2>
                    </div>
                    <p class="text-gray-400 mt-2">For PUP Mulanay Students</p>
                </div>
                <div class="flex space-x-6">
                    <a href="#" class="hover:text-indigo-400"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="hover:text-indigo-400"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="hover:text-indigo-400"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-6 pt-6 text-center text-gray-400">
                <p>&copy; 2023 BrightMind. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Load data from localStorage
        document.addEventListener('DOMContentLoaded', function() {
            const iqResults = JSON.parse(localStorage.getItem('brightmind_iq_scores')) || [];
            const healthData = JSON.parse(localStorage.getItem('brightmind_health_data')) || [];
            const chatHistory = JSON.parse(localStorage.getItem('brightmind_chat_history')) || [];
            
            // Update summary cards
            updateSummaryCards(iqResults, healthData);
            
            // Create charts
            createCognitiveChart(iqResults);
            createHealthChart(healthData);
            
            // Populate activity table
            populateActivityTable(iqResults, healthData, chatHistory);
            
            // Generate insights
            generateInsights(iqResults, healthData);
        });
        
        // Update summary cards
        function updateSummaryCards(iqResults, healthData) {
            // Cognitive score
            if (iqResults.length > 0) {
                const latestIq = iqResults[iqResults.length - 1];
                document.getElementById('cognitive-score').textContent = `${latestIq.percentage}%`;
                
                // Calculate trend
                if (iqResults.length > 1) {
                    const prevIq = iqResults[iqResults.length - 2];
                    const change = latestIq.percentage - prevIq.percentage;
                    const trendElement = document.getElementById('cognitive-trend');
                    const changeElement = document.getElementById('cognitive-change');
                    
                    if (change > 0) {
                        trendElement.innerHTML = '<i class="fas fa-arrow-up text-green-500"></i>';
                        changeElement.textContent = `${Math.abs(change)}% increase`;
                        changeElement.className = 'text-sm text-green-500';
                    } else if (change < 0) {
                        trendElement.innerHTML = '<i class="fas fa-arrow-down text-red-500"></i>';
                        changeElement.textContent = `${Math.abs(change)}% decrease`;
                        changeElement.className = 'text-sm text-red-500';
                    } else {
                        trendElement.innerHTML = '<i class="fas fa-equals text-gray-500"></i>';
                        changeElement.textContent = 'No change';
                        changeElement.className = 'text-sm text-gray-500';
                    }
                }
            }
            
            // Health score
            if (healthData.length > 0) {
                const latestHealth = healthData[healthData.length - 1];
                const healthScore = Math.round((latestHealth.focus + latestHealth.sleep + latestHealth.energy) / 3);
                document.getElementById('health-score').textContent = `${healthScore}%`;
                
                // Calculate trend
                if (healthData.length > 1) {
                    const prevHealth = healthData[healthData.length - 2];
                    const prevHealthScore = Math.round((prevHealth.focus + prevHealth.sleep + prevHealth.energy) / 3);
                    const change = healthScore - prevHealthScore;
                    const trendElement = document.getElementById('health-trend');
                    const changeElement = document.getElementById('health-change');
                    
                    if (change > 0) {
                        trendElement.innerHTML = '<i class="fas fa-arrow-up text-green-500"></i>';
                        changeElement.textContent = `${Math.abs(change)}% increase`;
                        changeElement.className = 'text-sm text-green-500';
                    } else if (change < 0) {
                        trendElement.innerHTML = '<i class="fas fa-arrow-down text-red-500"></i>';
                        changeElement.textContent = `${Math.abs(change)}% decrease`;
                        changeElement.className = 'text-sm text-red-500';
                    } else {
                        trendElement.innerHTML = '<i class="fas fa-equals text-gray-500"></i>';
                        changeElement.textContent = 'No change';
                        changeElement.className = 'text-sm text-gray-500';
                    }
                }
            }
            
            // Study score (mock data for now)
            const studyScore = Math.floor(Math.random() * 30) + 70; // 70-100
            document.getElementById('study-score').textContent = `${studyScore}%`;
            document.getElementById('study-trend').innerHTML = '<i class="fas fa-arrow-up text-green-500"></i>';
            document.getElementById('study-change').textContent = '5% increase';
            document.getElementById('study-change').className = 'text-sm text-green-500';
        }
        
        // Create cognitive performance chart
        function createCognitiveChart(iqResults) {
            if (iqResults.length === 0) {
                document.getElementById('cognitive-chart').parentElement.innerHTML += 
                    '<p class="text-gray-500 text-center py-8">No cognitive test data available</p>';
                return;
            }
            
            const ctx = document.getElementById('cognitive-chart').getContext('2d');
            const labels = iqResults.map(result => {
                const date = new Date(result.date);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            const data = iqResults.map(result => result.percentage);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Cognitive Score (%)',
                        data: data,
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Score: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: Math.max(0, Math.min(...data) - 10),
                            max: Math.min(100, Math.max(...data) + 10),
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Create health metrics chart
        function createHealthChart(healthData) {
            if (healthData.length === 0) {
                document.getElementById('health-chart').parentElement.innerHTML += 
                    '<p class="text-gray-500 text-center py-8">No health check data available</p>';
                return;
            }
            
            const ctx = document.getElementById('health-chart').getContext('2d');
            const labels = healthData.map(data => {
                const date = new Date(data.date);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Focus Score',
                            data: healthData.map(data => data.focus),
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Sleep Quality',
                            data: healthData.map(data => data.sleep),
                            backgroundColor: 'rgba(99, 102, 241, 0.7)',
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Energy Level',
                            data: healthData.map(data => data.energy),
                            backgroundColor: 'rgba(245, 158, 11, 0.7)',
                            borderColor: 'rgba(245, 158, 11, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Populate activity table
        function populateActivityTable(iqResults, healthData, chatHistory) {
            const tableBody = document.getElementById('activity-table');
            tableBody.innerHTML = '';
            
            // Combine all activities
            const activities = [];
            
            // Add IQ tests
            iqResults.forEach(result => {
                activities.push({
                    date: result.date,
                    type: 'IQ Test',
                    result: `${result.score}/${result.totalQuestions} (${result.percentage}%)`
                });
            });
            
            // Add health checks
            healthData.forEach(data => {
                activities.push({
                    date: data.date,
                    type: 'Health Check',
                    result: `Focus: ${data.focus}%, Sleep: ${data.sleep}%, Energy: ${data.energy}%`
                });
            });
            
            // Add tutoring sessions (last 3)
            const tutoringSessions = chatHistory.filter(msg => msg.sender === 'ai').length;
            if (tutoringSessions > 0) {
                activities.push({
                    date: new Date().toISOString(),
                    type: 'AI Tutoring',
                    result: `${tutoringSessions} sessions completed`
                });
            }
            
            // Sort by date (newest first)
            activities.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Display only the last 5 activities
            const recentActivities = activities.slice(0, 5);
            
            if (recentActivities.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="3" class="px-6 py-4 text-center text-gray-500">No recent activity</td>
                    </tr>
                `;
                return;
            }
            
            recentActivities.forEach(activity => {
                const date = new Date(activity.date);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formattedDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${activity.type}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${activity.result}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Generate personalized insights
        function generateInsights(iqResults, healthData) {
            const strengthsList = document.getElementById('strengths-list');
            const improvementList = document.getElementById('improvement-list');
            
            if (iqResults.length === 0 && healthData.length === 0) {
                strengthsList.innerHTML = '<li>Complete assessments to get personalized insights</li>';
                improvementList.innerHTML = '<li>Complete assessments to get personalized insights</li>';
                return;
            }
            
            // Cognitive strengths
            if (iqResults.length > 0) {
                const latestIq = iqResults[iqResults.length - 1];
                
                if (latestIq.percentage >= 80) {
                    strengthsList.innerHTML += '<li>Strong logical reasoning and problem-solving skills</li>';
                } else if (latestIq.percentage >= 60) {
                    strengthsList.innerHTML += '<li>Good foundational cognitive abilities</li>';
                }
                
                if (iqResults.length > 1) {
                    const change = latestIq.percentage - iqResults[0].percentage;
                    if (change > 5) {
                        strengthsList.innerHTML += `<li>Significant improvement (+${change}%) since your first test</li>`;
                    }
                }
            }
            
            // Health strengths
            if (healthData.length > 0) {
                const latestHealth = healthData[healthData.length - 1];
                
                if (latestHealth.focus >= 70) {
                    strengthsList.innerHTML += '<li>Excellent focus and concentration</li>';
                }
                
                if (latestHealth.sleep >= 70) {
                    strengthsList.innerHTML += '<li>Good sleep habits</li>';
                }
                
                if (latestHealth.energy >= 70) {
                    strengthsList.innerHTML += '<li>Consistent energy levels</li>';
                }
            }
            
            // Areas for improvement
            if (iqResults.length > 0) {
                const latestIq = iqResults[iqResults.length - 1];
                
                if (latestIq.percentage < 60) {
                    improvementList.innerHTML += '<li>Practice pattern recognition and logic puzzles</li>';
                }
                
                if (latestIq.percentage < 80) {
                    improvementList.innerHTML += '<li>Work on processing speed with timed exercises</li>';
                }
            }
            
            if (healthData.length > 0) {
                const latestHealth = healthData[healthData.length - 1];
                
                if (latestHealth.stress > 50) {
                    improvementList.innerHTML += '<li>Implement stress-reduction techniques</li>';
                }
                
                if (latestHealth.sleep < 60) {
                    improvementList.innerHTML += '<li>Improve sleep quality and duration</li>';
                }
                
                if (latestHealth.energy < 60) {
                    improvementList.innerHTML += '<li>Increase energy through better nutrition and exercise</li>';
                }
            }
            
            // Default messages if no specific insights
            if (strengthsList.innerHTML === '') {
                strengthsList.innerHTML = '<li>Complete more assessments to identify strengths</li>';
            }
            
            if (improvementList.innerHTML === '') {
                improvementList.innerHTML = '<li>Complete more assessments to identify areas for improvement</li>';
            }
        }
    </script>
</body>
</html>